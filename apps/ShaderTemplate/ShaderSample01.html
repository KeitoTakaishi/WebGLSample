<!--canvas上でのglslTemplate-->
<html>
<head>
    <title>Shader Test</title>
    <style>
        body {
            border: 0;
            background-color: white;
        }
        canvas {
            width: 400px;
            height: 400px;
            display: block;
        }
    </style>
</head>
<body>
<canvas id="c" width="400" height="400"></canvas>
<script src="../../Three_js/build/three.js"></script>

<script id="vertexShader" type="x-shader/x-vertex">
        void main() {
            gl_Position = vec4( position, 1.0 );
        }
</script>
<script id="fragmentShader" type="x-shader/x-fragment">
        uniform vec2 u_resolution;
        uniform float u_time;

        float circle(vec2 st){
           return step(0.3, distance(vec2(0.5), st));
        }

        void main() {
            vec2 st = gl_FragCoord.xy/u_resolution.xy;

            //distort
            float x = 2.0 * st.y + sin(u_time * 1.0);
            float distort = sin(u_time * 10.0) * 0.1 *
                            sin(5.0 * x) * (- (x - 1.0) * (x - 1.0) + 1.0);

            st.x += distort;


            float c = circle(st);

            gl_FragColor = vec4(circle(st - vec2(0, distort) * 0.3),
                                circle(st + vec2(0, distort) * 0.3),
                                circle(st + vec2(distort, 0) * 0.3),
                                1);
        }
</script>

<script>
  var container;
  var camera, scene, renderer;
  var uniforms;

  init();
  animate();

  function init() {
    container = document.getElementById( 'c' );

    camera = new THREE.Camera();
    camera.position.z = 1;

    scene = new THREE.Scene();

    var geometry = new THREE.PlaneBufferGeometry( 2, 2 );

    uniforms = {
      u_time: { type: "f", value: 1.0 },
      u_resolution: { type: "v2", value: new THREE.Vector2() },
      u_mouse: { type: "v2", value: new THREE.Vector2() }
    };

    var material = new THREE.ShaderMaterial( {
      uniforms: uniforms,
      vertexShader: document.getElementById( 'vertexShader' ).textContent,
      fragmentShader: document.getElementById( 'fragmentShader' ).textContent
    } );

    var mesh = new THREE.Mesh( geometry, material );
    scene.add( mesh );

    renderer = new THREE.WebGLRenderer({
      canvas: container,
    });
    renderer.setSize(400, 400);
    uniforms.u_resolution.value.x = renderer.domElement.width;
    uniforms.u_resolution.value.y = renderer.domElement.height;
  }

  function animate() {
    requestAnimationFrame( animate );
    render();
  }

  function render() {
    uniforms.u_time.value += 0.05;
    renderer.render( scene, camera );
  }
</script>
</body>
</html>
