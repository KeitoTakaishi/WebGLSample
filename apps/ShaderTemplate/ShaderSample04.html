<!--平行光源-->

<html>
	<head>
		<title>My first three.js app</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="../../Three_js/build/three.js"></script>
		<script src="minMatrix.js"></script>
		<script>
			var ParamsShaderMaterial = {
				uniforms: {
					"time": {value: 1.0},
					"LightDir" : { type: "v3", value: new THREE.Vector3( 0, 1, 2 ) },
					"invMatrix" : { type: "m4", value: new THREE.Matrix4() }
				},
				vertexShader: [
					"precision mediump float;",
					"uniform float time;",
					"uniform vec3 LightDir;",
					"varying vec3 vNormal;",
					"void main() {",
					"gl_PointSize = 1.5;",
          "vec3 p = position;",
          "float t = time * 0.001;",
					"p += 10.0*normal*sin(t + p.x * 100.0 + p.y * 100.0 + p.z * 100.0);",
          //"p.y += 100.0*sin(t);",
					"vNormal = normal;",
					"gl_Position = projectionMatrix * modelViewMatrix * vec4( p, 1.0 );",
					"}"
				].join( "\n" ),
				fragmentShader: [
					"precision mediump float;",
					"uniform float time;",
					"uniform vec3 LightDir;",
					"varying vec3 vNormal;",
					"void main() {",
					"float d = dot(vNormal, vec3(85.0*cos(time*0.001), 0.0, 85.0*sin(time*0.001)));",
					"d = clamp(d, 0.1, 1.0);",
					"gl_FragColor = vec4(d + 0.09, d + 0.09, d + 0.06, 1.0);",
					"}"
				].join( "\n" ),
			}

      var scene, camera, renderer, geometry;
			scene = new THREE.Scene();
			camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );
      camera.position.set(0, 0.0, 200.0);
      camera.lookAt(new THREE.Vector3());

			renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );


      init();
      animate();

      function init(){
        //var geometry = new THREE.PlaneGeometry(5, 5, 10, 10);
        var geometry = new THREE.SphereGeometry(50, 50, 50);
        material = new THREE.ShaderMaterial(ParamsShaderMaterial);
        mesh = new THREE.Mesh(geometry, material);
				//mesh = new THREE.Points(geometry, material);
        scene.add(mesh);
      }

      function animate(){
        requestAnimationFrame(animate);
        render();
      }

      function render(){
        time = performance.now();
        material.uniforms.time.value = time;
				material.uniforms.LightDir.value = THREE.Vector3(50.0, 50.0, 0.0);
				material.uniforms.ininvMatrix.value =
        renderer.render(scene, camera);
      }

	   </script>
	</body>
</html>
