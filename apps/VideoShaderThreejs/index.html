<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Bad TV </title>
  <link rel="stylesheet" href="./css/master.css">
</head>


<body>
  <div id='info'>BadTV Shader for Three.js by @felixturner. Click to randomize.</div>
  <div id='container'></div>

  <script src='lib/three.js'></script>
  <script src='lib/three.min.js'></script>
  <script src='lib/dat.gui.min.js'></script>
  <script src='lib/stats.min.js'></script>
  <script src='lib/postprocessing/EffectComposer.js'></script>
  <script src='lib/postprocessing/RenderPass.js'></script>
  <script src='lib/shaders/RGBShiftShader.js'></script>
  <script src='lib/postprocessing/ShaderPass.js'></script>
  <script src='lib/postprocessing/MaskPass.js'></script>
  <script src='js/StaticShader.js'></script>

  <script src='lib/shaders/CopyShader.js'></script>
  <script src='lib/shaders/FilmShader.js'></script>


  <script>
    var camera, scene, renderer;
    var video, videoTexture, videoMaterial;
    var composer;
    var renderPass;
    var rgbShiftEffect;
    var staticParams, staticPass;
    var shaderTime = 0;

    init();
    anime();

    function init() {
      camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
      camera.position.z = 1000;

      scene = new THREE.Scene();

      video = document.createElement('video');
      video.loop = true;
      video.src = 'res/fits.mp4';
      video.play();

      videoTexture = new THREE.VideoTexture(video);
      videoTexture.minFilter = THREE.LinearFilter
      videoTexture.magFilter = THREE.LinearFilter;
      videoMaterial = new THREE.MeshBasicMaterial({
        map: videoTexture
      });

      var material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
      var planeGeometry = new THREE.PlaneGeometry( 1080, 720,1,1 );
      var plane = new THREE.Mesh( planeGeometry, videoMaterial );
			scene.add( plane );
			plane.z = 0;
			plane.scale.x = plane.scale.y = 1.45;

      renderer = new THREE.WebGLRenderer();
      renderer.setClearColor(0xee8888);
      renderer.setSize( 800, 600 );

      composer = new THREE.EffectComposer(renderer);
      renderPass = new THREE.RenderPass(scene, camera);
      composer.addPass(renderPass);
      document.body.appendChild( renderer.domElement );


      //posr processing
      //rgb shift
      rgbShiftEffect = new THREE.ShaderPass( THREE.RGBShiftShader );
      rgbShiftEffect.uniforms[ 'amount' ].value = 0.003;
      composer.addPass(rgbShiftEffect);
      rgbShiftEffect.renderToScreen = true;
      //static shader
      staticPass = new THREE.ShaderPass( THREE.StaticShader );
      staticParams = {
			 	show: true,
			 	amount:0.5,
			 	size:4.0
			};
      staticPass.uniforms[ 'amount' ].value = staticParams.amount;
			staticPass.uniforms[ 'size' ].value = staticParams.size;

      composer.addPass( staticPass );


    }

    function anime() {
      shaderTime += 0.1;
      var time = new Date();
      var sec = time.getMilliseconds();
      rgbShiftEffect.uniforms[ 'amount' ].value = 0.01*Math.sin(sec*1.0);
      staticPass.uniforms[ 'time' ].value =  shaderTime;
      composer.render();
      requestAnimationFrame(anime);

    }

    function onResize() {
      renderer.setSize(window.innerWidth, window.innerHeight);
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
    }
  </script>
</body>
</html>
